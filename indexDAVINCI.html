<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Visor GLB sencillo</title>
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
  <style>
    body{margin:0;font-family:system-ui,Arial;background:#f2f2f2}
    header{padding:12px;background:#222;color:#fff}
    main{padding:12px}
    #viewer{width:100%;height:60vh;background:#111;display:block;border-radius:8px;overflow:hidden}
    #status{margin-top:8px;padding:10px;background:#fff;border-radius:6px;box-shadow:0 1px 3px rgba(0,0,0,.08)}
    pre{white-space:pre-wrap;word-break:break-word;background:#fff;padding:10px;border-radius:6px;margin-top:8px;box-shadow:0 1px 3px rgba(0,0,0,.05)}
    button{margin-right:8px;padding:8px 12px;border-radius:6px;border:1px solid #ccc;background:#fff;cursor:pointer}
  </style>
</head>
<body>
  <header>
    <strong>Visor GLB — plantilla simple</strong>
  </header>
  <main>
    <!--
      1) Coloca tu archivo .glb en la MISMA carpeta que este index.html
      2) Nómbralo exactamente: model.glb  (o cambia la constante MODEL_PATH abajo)
      3) Sube ambos archivos al repo y publica con GitHub Pages
    -->

    <model-viewer id="viewer"
      src="./model.glb"
      alt="Mi modelo 3D"
      camera-controls
      auto-rotate
      interaction-prompt="none"
      style="width:100%;height:60vh">
    </model-viewer>

    <div id="status">Estado: listo — si está en blanco, usa los botones de abajo para diagnosticar.</div>

    <div style="margin-top:8px">
      <button id="btn-check">Comprobar .glb (fetch)</button>
      <button id="btn-open">Abrir .glb en nueva pestaña</button>
      <button id="btn-public">Cargar modelo público de prueba</button>
    </div>

    <pre id="log"></pre>
  </main>

  <script>
    const MODEL_PATH = './model.glb'; // si quieres otro nombre, cámbialo aquí
    const viewer = document.getElementById('viewer');
    const status = document.getElementById('status');
    const logEl = document.getElementById('log');
    const btnCheck = document.getElementById('btn-check');
    const btnOpen = document.getElementById('btn-open');
    const btnPublic = document.getElementById('btn-public');

    function log(s){ logEl.textContent += s + '\n'; }
    function clearLog(){ logEl.textContent = ''; }

    // Eventos viewer
    viewer.addEventListener('load', ()=>{
      status.textContent = 'Modelo cargado correctamente.';
      log('viewer: evento load recibido.');
    });
    viewer.addEventListener('error', ev =>{
      status.textContent = 'Error al cargar el modelo: revisa consola o usa el botón "Comprobar .glb"';
      log('viewer error event: ' + JSON.stringify(ev?.detail || ev));
    });

    // Botón: fetch para checar headers/status
    btnCheck.addEventListener('click', async ()=>{
      clearLog();
      status.textContent = 'Comprobando: ' + MODEL_PATH;
      try {
        const resp = await fetch(MODEL_PATH, { method:'GET', cache:'no-store' });
        log('HTTP status: ' + resp.status + ' ' + resp.statusText);
        log('Content-Type: ' + resp.headers.get('content-type'));
        log('Content-Length: ' + resp.headers.get('content-length'));
        if (resp.ok){
          const size = (await resp.arrayBuffer()).byteLength;
          log('Tamaño descargado (bytes): ' + size);
          status.textContent = 'Recurso accesible (HTTP ' + resp.status + '). Si no ves el modelo, prueba en otra pestaña o revisa consola.';
        } else {
          status.textContent = 'Error HTTP: ' + resp.status + ' ' + resp.statusText;
        }
      } catch(err){
        status.textContent = 'Fetch falló: ' + err.message;
        log('Fetch error: ' + err);
        log('Posible causa: CORS, mixed content (HTTP/HTTPS) o service worker bloqueando. Prueba en incógnito.');
      }
    });

    btnOpen.addEventListener('click', ()=>{
      window.open(MODEL_PATH, '_blank');
    });

    btnPublic.addEventListener('click', ()=>{
      viewer.src = 'https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/DamagedHelmet/glTF-Binary/DamagedHelmet.glb';
      status.textContent = 'Cargando modelo público de prueba...';
    });

    // Ejecutar pequeño check al cargar
    window.addEventListener('load', ()=>{
      viewer.src = MODEL_PATH; // asigna la ruta por defecto
      log('Ruta por defecto: ' + MODEL_PATH);
    });
  </script>
</body>
</html>






