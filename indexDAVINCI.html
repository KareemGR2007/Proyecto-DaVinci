<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>GLB Viewer — Debug fácil</title>
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
  <style>
    body{margin:0;font-family:system-ui,Arial}
    #viewer{width:100vw;height:65vh;background:#111;display:block}
    #status{padding:10px;background:#f5f5f5}
    pre{white-space:pre-wrap;word-break:break-word}
    button{margin:6px}
  </style>
</head>
<body>
  <!-- Cambia la ruta abajo -->
  <script>
    // Pon aquí la ruta exacta relativa al index.html
    const MODEL_PATH = './Duck.glb';
  </script>

  <model-viewer id="viewer"
    src=""
    alt="Mi modelo 3D"
    camera-controls
    auto-rotate
    interaction-prompt="none"
    style="width:100%;height:65vh">
  </model-viewer>

  <div id="status">Estado: iniciando...</div>
  <div style="padding:10px">
    <button id="btn-check">Comprobar .glb (fetch)</button>
    <button id="btn-open">Abrir .glb en nueva pestaña</button>
    <button id="btn-swap">Probar modelo público</button>
  </div>

  <pre id="output"></pre>

  <script>
    const viewer = document.getElementById('viewer');
    const status = document.getElementById('status');
    const out = document.getElementById('output');
    const btnCheck = document.getElementById('btn-check');
    const btnOpen = document.getElementById('btn-open');
    const btnSwap = document.getElementById('btn-swap');

    // Asignar la ruta al viewer
    viewer.src = MODEL_PATH;
    status.textContent = 'Cargando: ' + MODEL_PATH;

    function log(s){ out.textContent += s + "\\n"; }

    viewer.addEventListener('load', ()=> status.textContent = 'Modelo cargado correctamente.');
    viewer.addEventListener('error', ev => {
      status.textContent = 'model-viewer ERROR: ' + (ev?.detail?.message || JSON.stringify(ev?.detail) || 'desconocido');
      log('model-viewer event: ' + JSON.stringify(ev?.detail));
    });

    btnCheck.addEventListener('click', async () => {
      out.textContent = '';
      status.textContent = 'Comprobando ' + MODEL_PATH + ' ...';
      try {
        const resp = await fetch(MODEL_PATH, { method: 'GET', cache: 'no-store' });
        log('HTTP status: ' + resp.status + ' ' + resp.statusText);
        log('Content-Type: ' + resp.headers.get('content-type'));
        log('Content-Length: ' + resp.headers.get('content-length'));
        log('Cache-Control: ' + resp.headers.get('cache-control'));
        if (resp.ok) {
          const size = (await resp.arrayBuffer()).byteLength;
          log('Tamaño (bytes): ' + size);
          status.textContent = 'Recurso accesible (HTTP ' + resp.status + ').';
        } else {
          status.textContent = 'Error HTTP: ' + resp.status;
        }
      } catch(err){
        status.textContent = 'Fetch falló: ' + err.message;
        log('Fetch error: ' + err);
      }
    });

    btnOpen.addEventListener('click', () => window.open(MODEL_PATH, '_blank'));

    btnSwap.addEventListener('click', () => {
      viewer.src = 'https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/DamagedHelmet/glTF-Binary/DamagedHelmet.glb';
      status.textContent = 'Cargando modelo público de prueba...';
    });

    // Info service workers
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.getRegistrations().then(regs => {
        if (regs.length) log('Service workers registrados: ' + regs.length + ' (ve a DevTools > Application para unregister).');
        else log('No hay service workers registrados.');
      });
    }
  </script>
</body>
</html>



